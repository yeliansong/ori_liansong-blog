---
layout:     post   				    # 使用的布局（不需要改）
title:      kubeadm     # 标题
subtitle:   学习笔记 #副标题
date:       2019-12-28 				# 时间
author:     Liansong 						# 作者
header-img: img/post-bg-android.jpg 	#这篇文章标题背景图片
catalog: true 						# 是否归档
tags:								#标签
    - 学习笔记
    - tech
    - k8s
---


### 1. kubeadm

 		We know minikube, minikube is used to deploy the single node in the local environment. But if you want to deploy  multiple nodes, you must use kubeadm.

It can add the pod to the master cluster. Let's start to learn it.



### 2. Install kubeadm

​		It's simple. Use below commands to install the kubeadm.

```bash
sudo apt-get update && sudo apt-get install -y apt-transport-https curl
curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -
cat <<EOF | sudo tee /etc/apt/sources.list.d/kubernetes.list
deb https://apt.kubernetes.io/ kubernetes-xenial main
EOF
sudo apt-get update
sudo apt-get install -y kubelet kubeadm kubectl
sudo apt-mark hold kubelet kubeadm kubectl
```



### 3. Kubeadm Bootstrap

​	 Use kubeadm init to start kubeadm. 

​    ***Kubeadm init --pod-network-cidr=10.244.0.0/16 --ignore-preflight-errors =  all.***

​    Then after start, you can operate the kubeadm. 

   Then you need to set up the net plugin.

```shell
kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/2140ac876ef134e0ed5af15c65e414cf26827915/Documentation/kube-flannel.yml
```

  I use the flannel network mode. So I use this command. You need to set according to your choose.



### 4. Troubleshooting

-  Kubeadm init --pod-network-cidr=10.244.0.0/16 --ignore-preflight-errors = NumCPU hit the error:

  ERROR Swap]: running with swap on is not supported. Please disable swap

  [preflight] If you know what you are doing, you can make a check non-fatal with `--ignore-preflight-errors=...`

  error execution phase preflight

  ***Solution: ignore the error. Use this command.***

  ***Kubeadm init --pod-network-cidr=10.244.0.0/16 --ignore-preflight-errors =  all.***

  

-  sudo docker pull [k8s.gcr.io/kube-apiserver-amd64:v1.10.2](http://k8s.gcr.io/kube-apiserver-amd64:v1.10.2)

  Error response from daemon: Get https://k8s.gcr.io/v2/: proxyconnect tcp: dial tcp: lookup [gemfield.org](http://gemfield.org) on [127.0.1.1](127.0.1.1):53: no such host

  ***Solution: set the docker environment. Refers to this link:***
  ***https://zhuanlan.zhihu.com/p/31398416***

  ***Also, refer to this Link:***
  ***https://stackoverflow.com/questions/52119985/kubeadm-init-shows-kubelet-isnt-running-or-healthy***

  

-  sudo kubectl version, hit this error:

   The connection to the server localhost:8080 was refused - did you specify the right host or port?

  ***Solution: Because you need to add the kubernetes apiserver config file.***

  **mkdir -p $HOME/.kube
    sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config**
  **sudo chown $(id -u):$(id -g) $HOME/.kube/config**

  

  

  

  

  
